Quero que corrija o fluxo de autenticação e a configuração do banco Postgres (Neon) do meu projeto HubPDF. 
Siga exatamente os passos abaixo, sem alterar layout, estilos, rotas públicas ou conteúdo do site. 
Não toque em páginas/UX fora do necessário para login/registro.

## 0) Contexto do erro
- Ao tentar login, aparece: `EMAIL NAO CADASTRAD. <a href="/auth/register"...>`.
- Já existe um banco NEON Postgres com tabelas como `users`, `quota_usage` etc.
- Preciso garantir que o app está realmente usando o Postgres (Neon) e não um banco local/SQLite/memória.

## 1) Conexão com o Postgres (Neon)
- Use a variável de ambiente `DATABASE_URL` (já setada no Replit) para a conexão. 
- Garanta SSL obrigatório (Neon exige). Se necessário, acrescente `?sslmode=require` no connection string.
- Se o projeto usar Node:
  - Utilize `pg` com pool:
    ```js
    import pg from "pg";
    const pool = new pg.Pool({
      connectionString: process.env.DATABASE_URL,
      ssl: { rejectUnauthorized: false }
    });
    export default pool;
    ```
  - Crie um helper `db/health` para testar:
    ```js
    // /api/db/health.js ou equivalente
    import pool from "@/lib/db";
    export default async function handler(req,res){
      const r = await pool.query("select 1 as ok");
      res.status(200).json({ ok: r.rows[0].ok === 1 });
    }
    ```
- Se o projeto usar Prisma:
  - Configure `DATABASE_URL` no `.env` e rode `prisma generate`.
  - Ajuste schema para Postgres e SSL conforme a doc do Prisma/Neon.
- Remova QUALQUER fallback para SQLite, memória, arquivos JSON ou bancos embutidos.

## 2) Esquema e índices (garantir caso-insensitive por e-mail)
- Certifique-se que a tabela `users` possui as colunas abaixo (ou crie migração idempotente `CREATE TABLE IF NOT EXISTS`):
  ```sql
  create table if not exists users (
    id uuid primary key default gen_random_uuid(),
    email text not null,
    password_hash text not null,
    name text,
    created_at timestamptz not null default now(),
    updated_at timestamptz not null default now()
  );
  create unique index if not exists users_email_lower_key on users (lower(email));
Atualize triggers/updated_at se houver.

3) Registro (/auth/register)
Implementar/ajustar rota POST /auth/register:

Validar e-mail e senha.

email_norm = lower(email).

Verificar se já existe: select id from users where lower(email) = $1.

Se não existir: criar com bcrypt.hash(senha, 12) em password_hash.

Responder 201 com mensagem de sucesso; redirecionar para /auth/login.

Mensagens em PT-BR.

4) Login (/auth/login)
Implementar/ajustar rota POST /auth/login:

Buscar usuário: select id, password_hash, name from users where lower(email) = $1.

Se não achar, responder 404 com: E-mail não cadastrado. <a href="/auth/register" class="text-red-600 hover:text-red-500 font-medium underline">Clique aqui para se cadastrar</a>.

Se achar, comparar bcrypt.compare(senha, password_hash).

Se ok, criar sessão (cookie seguro httpOnly) e redirecionar para a área desejada (ex.: /home).

Se senha inválida, 401 com mensagem Senha incorreta.

5) Seed de usuário de teste (opcional, útil para validar)
Criar script idempotente scripts/seed_user.sql:

sql
Copiar código
insert into users (email, password_hash, name)
values ('teste@hubpdf.dev', '$2b$12$W6w0jz1tN2....HASH_DE_BCRYPT...', 'Usuário Teste')
on conflict (lower(email)) do nothing;
Gere um hash bcrypt para a senha hubpdf123! e use no seed.

Executar o seed automaticamente em ambiente de DEV, nunca em PROD sem flag.

6) Correções de i18n e UX
Corrigir o texto “EMAIL NAO CADASTRAD.” para “E-mail não cadastrado.” (acentos corretos).

As páginas /auth/login e /auth/register devem exibir mensagens de erro/sucesso em PT-BR.

Não alterar visual, apenas textos.

7) Testes automáticos mínimos
Criar testes simples (ou script manual) para:

/api/db/health retorna {ok:true};

Registro de novo e-mail retorna 201 e cria usuário no Postgres;

Login com esse e-mail e senha válidos cria sessão (verificar cookie/set-cookie);

Login com e-mail desconhecido retorna 404 com link para registro.

8) Segurança
Cookies de sessão httpOnly, sameSite=lax, secure quando NODE_ENV=production.

Nunca logar senha ou hash em console.

Sanitizar inputs e usar parâmetros em SQL (nada de string concat).

9) Não alterar
Não alterar conteúdo das páginas institucionais (Sobre/Termos/Privacidade/Contato) ou rotas públicas.

Não reverter as mudanças anteriores que removeram “Upgrade/Pro”.

Não criar dependência com serviços pagos.

Ao finalizar:

Mostre os arquivos alterados (diff).

Informe como rodar localmente: npm i / npm run dev, e como testar as rotas de auth.

yaml
Copiar código

---

Se quiser, te passo **um seed SQL já com o hash bcrypt pronto** e os **endpoints em Express/Next** no formato do teu projeto.
::contentReference[oaicite:0]{index=0}