HubPDF with Mercado Pago, Freemium, Admin Panel, Multilingual (PT-BR default, EN optional), Security-First

Build a web app named HubPDF on Replit Core. The product is a PDF tools hub with secure authentication, freemium + paid plans via Mercado Pago, admin dashboard, and multilingual support (Portuguese-Brazilian as default, English as optional).

Priorities: security, privacy, temporary file hygiene, quotas with watermark gating, RBAC admin, and clean, testable code.

1) Tech stack & project layout

Backend: FastAPI

UI: Jinja2 + HTMX + Tailwind (CDN)

DB: SQLite MVP (structure ready for Postgres later)

i18n: load text strings from locales/pt.json and locales/en.json; default = PT-BR. Provide a simple language switcher (cookie/session).

Jobs: BackgroundTasks MVP, structured for queue later

PWA hooks: add stubs for manifest.json and service-worker.js

Project tree (only changes: add locales/):

app/
  ...
  locales/
    pt.json
    en.json
  services/i18n.py   # helper to load translations


locales/pt.json example:

{
  "title": "HubPDF",
  "btn_login": "Entrar",
  "btn_register": "Registrar",
  "btn_download": "Baixar",
  "msg_error": "Ocorreu um erro",
  "plan_free": "Grátis",
  "plan_pro": "Pro",
  "plan_business": "Business",
  "watermark_text": "Gerado com HubPDF"
}


locales/en.json example:

{
  "title": "HubPDF",
  "btn_login": "Login",
  "btn_register": "Register",
  "btn_download": "Download",
  "msg_error": "An error occurred",
  "plan_free": "Free",
  "plan_pro": "Pro",
  "plan_business": "Business",
  "watermark_text": "Generated with HubPDF"
}


Use code in templates like:

{{ t("btn_login") }}


where t() loads from current locale (default = pt).

2) Authentication

Email + password (Argon2 hashed)

Google OAuth 2.0 (Authlib)

JWT access/refresh in HttpOnly Secure cookies

CSRF tokens for forms (HTMX)

RBAC: roles = user, admin

Admin panel only accessible to role=admin

3) Plans & quotas (with watermark gating)

Free

10 MB max/file

8 ops/day

Ops 1-4 = normal output

Ops 5-8 = apply watermark (localized text: “Gerado com HubPDF” or “Generated with HubPDF”)

Pro — R$ 14,90/month

100 MB max/file

200 ops/day

No watermark; job history

Business — R$ 29,90/month

250 MB max/file

500 ops/day

Multi-seats (later)

Advanced features (OCR, HTML→PDF) — leave flags

4) Mercado Pago integration

/pricing: show 3 plans (localized labels)

POST /billing/checkout: creates MP Checkout preference → redirect URL

POST /billing/webhook: verify signature (x-signature), check payment via MP_ACCESS_TOKEN. If approved → update user plan & subscription record.

/account/plan: show current plan, usage, renewal date, manage subscription

5) Admin dashboard

Dashboard: KPIs (users, revenue, active subs)

Users: search/edit plan, reset quotas, deactivate/promote

Subscriptions: adjust current_period_end, cancel/extend

Coupons: CRUD for promo codes (validity, %off)

Invoices: list by status, link to MP payment id

Audit log: record admin actions

6) Tools (MVP — 6 endpoints)

Implement endpoints with i18n UI strings:

Merge PDFs (pypdf)

Split PDFs by ranges (pypdf)

Compress PDFs (pikepdf)

PDF → Images (png/jpg zip) (pdf2image / pillow fallback)

Images → PDF (pillow)

Extract text (pdfplumber)

Rules:

Check user plan & daily counters

Free ops 1-4 normal; ops 5-8 add watermark overlay (localized)

Over quota = return upgrade message (localized)

7) Security requirements

Argon2 password hashing

JWT with rotation & invalidation on logout

CSRF for forms

Rate limit on uploads

Validate MIME & size; reject PDFs with JavaScript

Store only in /tmp/{user_id}/{job_id}, auto-delete after 30min

No PII in logs

Secrets only via ENV/Secrets

Admin panel fully RBAC protected

8) README must include

Setup in Replit Core

ENV vars: JWT_SECRET, GOOGLE_CLIENT_ID/SECRET, MP_ACCESS_TOKEN, WEBHOOK_SECRET

Mercado Pago sandbox setup & webhook config

Plan limits, quota logic, watermark rules

File retention policy

How to add new translations in locales/

Acceptance

 System defaults to PT-BR UI (labels, messages, watermark text).

 User can switch to EN manually (cookie/session).

 Login via email & Google works.

 Mercado Pago sandbox works; webhook updates plan to Pro/Business.

 Free plan enforces 8 ops/day; watermark from 5th op.

 Admin panel accessible only to admin; can manage users, subs, coupons.

 Security: Argon2, JWT rotation, CSRF, rate-limit, file cleanup confirmed.